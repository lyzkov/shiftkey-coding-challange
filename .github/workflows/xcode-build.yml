name: Xcode Build

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Xcode
        uses: actions/setup-xcode@v2
        with:
          xcode-version: '14.3'  # Replace with your desired Xcode version

      - name: Build Xcode project
        run: |
          project_name=$(find . -name "*.xcodeproj" -type d -exec basename {} \;)
          scheme_name=$(xcodebuild -list -project $project_name | awk '/Schemes/{flag=1; next} /Build Configurations/{flag=0} flag' | grep -v -e '^\s*$')
          xcodebuild build-for-testing -project $project_name -scheme $scheme_name -configuration Release
